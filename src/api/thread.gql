fragment ThreadFields on thread {
  id
  orgId
  circleId
  participantsScope
  participantsMembersIds
  initiatorMemberId
  title
  createdAt
  archived
  lastActivityId
  lastActivityDate
}

query getCircleThreadsIds($circleId: uuid!) {
  thread(where: { circleId: { _eq: $circleId }, archived: { _eq: false } }) {
    id
  }
}

subscription subscribeThread($id: uuid!, $memberId: uuid!) {
  thread_by_pk(id: $id) {
    ...ThreadFields
    member_status(where: { memberId: { _eq: $memberId } }, limit: 1) {
      lastReadActivityId
      lastReadDate
    }
  }
}

subscription subscribeThreads($filters: [thread_bool_exp!], $memberId: uuid!) {
  thread(where: { _and: $filters }) {
    ...ThreadFields
    member_status(where: { memberId: { _eq: $memberId } }, limit: 1) {
      lastReadActivityId
      lastReadDate
    }
  }
}

mutation createThread($values: thread_insert_input!) {
  insert_thread_one(object: $values) {
    ...ThreadFields
  }
}

mutation updateThread($id: uuid!, $values: thread_set_input!) {
  update_thread_by_pk(pk_columns: { id: $id }, _set: $values) {
    ...ThreadFields
  }
}

mutation archiveThread($id: uuid!) {
  update_thread_by_pk(pk_columns: { id: $id }, _set: { archived: true }) {
    id
  }
}
